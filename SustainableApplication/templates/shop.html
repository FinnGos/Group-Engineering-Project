{% extends 'base.html' %}

{% block content %}
<div class="text-center my-10">
  <!-- Large Shop Title -->
  <h2 class="text-5xl font-bold text-center mb-6">Shop</h2>

  <!-- Back Button to Game Map Page -->
  <a href="{% url 'map' %}" class="text-lg text-green-700 hover:text-green-500 mb-6 inline-block">
    <button class="px-6 py-2 border border-green-700 rounded-md bg-white hover:bg-green-50 focus:outline-none">
      Back to Map
    </button>
  </a>

  <h3 class="text-2xl font-semibold mb-4">Buy Items</h3>

  <ul class="space-y-4">
    {% for item in items %}
    <li class="flex justify-between items-center p-4 border rounded-md shadow-md bg-white">
      <span class="font-medium">{{ item.name }}</span> - <span class="text-green-700">{{ item.price }} Carbo Coins</span>

      <!-- Buy Item Button -->
      <form action="{% url 'buy_item' item.id %}" method="POST" class="buy-item-form">
        {% csrf_token %}
        <button type="submit" class="px-4 py-2 bg-green-700 text-white rounded-md hover:bg-green-600 focus:outline-none">
          Buy
        </button>
      </form>
    </li>
    {% empty %}
    <li class="text-gray-500">No items available.</li>
    {% endfor %}
  </ul>

  <!-- Message Box for Feedback -->
  <div id="message-box" class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 p-6 rounded-md shadow-md bg-white hidden">
    <p id="message-text" class="text-xl"></p>
    <button id="close-message" class="mt-4 px-4 py-2 bg-green-700 text-white rounded-md hover:bg-green-600 focus:outline-none">
      Close
    </button>
  </div>

</div>

<!-- JavaScript to Handle Feedback Messages -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Get the message box and text
    const messageBox = document.getElementById("message-box");
    const messageText = document.getElementById("message-text");
    const closeButton = document.getElementById("close-message");

    // Check if there are any messages from the backend
    {% if messages %}
      {% for message in messages %}
        // Display the appropriate message
        if ("{{ message.tags }}" === "success") {
          messageText.textContent = "Purchase successful!";
          messageBox.classList.remove("hidden");
        } else if ("{{ message.tags }}" === "error") {
          messageText.textContent = "Insufficient points to complete the purchase.";
          messageBox.classList.remove("hidden");
        }
      {% endfor %}
    {% endif %}

    // Close the message box when the user clicks "Close"
    closeButton.addEventListener("click", function () {
      messageBox.classList.add("hidden");
    });
  });
</script>

{% endblock %}
