{% extends 'base.html' %}

{% block extra_css %}
<style>
/* Mobile Adjustments for the Shop Page */
@media (max-width: 768px) {
  /* Scale down large headings */
  h2.text-5xl {
    font-size: 2rem !important; /* smaller than 5xl */
  }
  
  h3.text-2xl {
    font-size: 1.5rem !important; /* smaller than 2xl */
  }
  
  /* Reduce font size on links and paragraphs */
  .text-lg {
    font-size: 1rem !important;
  }
  
  /* Shrink the Back to Map button */
  a.text-lg button {
    padding: 0.5rem 1rem !important;
    font-size: 0.875rem !important;
  }
  
  /* For the list items (each product row) */
  ul li {
    padding: 0.5rem !important;
    flex-direction: column !important; /* Stack elements vertically */
    gap: 0.5rem;
  }
  
  /* Adjust the Buy button inside the form */
  .buy-item-form button {
    padding: 0.5rem 1rem !important;
    font-size: 0.875rem !important;
  }
  
  /* Adjust the Message Box for feedback */
  #message-box {
    padding: 0.75rem !important;
    width: 90% !important;
  }
  
  #message-text {
    font-size: 1rem !important;
  }
  
  /* Reduce overall margins on the container */
  .text-center.my-10 {
    margin: 2rem auto !important;
  }
}
</style>
{% endblock %}

{% block content %}
<div class="text-center my-10">
  <!-- Large Shop Title -->
  <h2 class="text-5xl font-bold text-center mb-6">Shop</h2>

  <!-- Back Button to Game Map Page -->
  <a href="{% url 'map' %}" class="text-lg text-green-700 hover:text-green-500 mb-6 inline-block">
    <button class="px-6 py-2 border border-green-700 rounded-md bg-white hover:bg-green-50 focus:outline-none">
      Back to Map
    </button>
  </a>

  <h3 class="text-2xl font-semibold mb-4">Buy Items</h3>

  <ul class="space-y-4">
    {% for item in items %}
    <li class="flex justify-between items-center p-4 border rounded-md shadow-md bg-white">
      <span class="font-medium">{{ item.name }}</span> - <span class="text-green-700">{{ item.price }} Carbo Coins</span>

      <!-- Buy Item Button -->
      <form action="{% url 'buy_item' item.id %}" method="POST" class="buy-item-form">
        {% csrf_token %}
        <button type="submit" class="px-4 py-2 bg-green-700 text-white rounded-md hover:bg-green-600 focus:outline-none">
          Buy
        </button>
      </form>
    </li>
    {% empty %}
    <li class="text-gray-500">No items available.</li>
    {% endfor %}
  </ul>

  <!-- Message Box for Feedback -->
  <div id="message-box" class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 p-6 rounded-md shadow-md bg-white hidden">
    <p id="message-text" class="text-xl"></p>
    <button id="close-message" class="mt-4 px-4 py-2 bg-green-700 text-white rounded-md hover:bg-green-600 focus:outline-none">
      Close
    </button>
  </div>

</div>

<!-- JavaScript to Handle Feedback Messages -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Get the message box and text
    const messageBox = document.getElementById("message-box");
    const messageText = document.getElementById("message-text");
    const closeButton = document.getElementById("close-message");

    // Check if there are any messages from Django's messages framework
    {% if messages %}
      {% for message in messages %}
        setTimeout(() => {
          if ("{{ message.tags }}" === "success") {
            messageText.textContent = "Purchase successful!";
            messageBox.classList.remove("hidden");
          } else if ("{{ message.tags }}" === "error") {
            messageText.textContent = "{{ message|escapejs }}";  // Ensure safe JavaScript output
            messageBox.classList.remove("hidden");
          }
        }, 100); // Slight delay to ensure elements exist
      {% endfor %}
    {% endif %}

    // Close the message box when the user clicks "Close"
    closeButton.addEventListener("click", function () {
      messageBox.classList.add("hidden");
    });
  });
</script>
{% endblock %}
